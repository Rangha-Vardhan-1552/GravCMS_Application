{% extends 'partials/base.html.twig' %}

{% block content %}
    <style>
        /* CSS for chat container */
        #chat-container {
            max-height: 300px;
            overflow-y: auto;
            padding: 10px;
            /* border: 1px solid #ccc;
            border-radius: 5px; */
        }

        #chat-form {
            justify-content: flex-end;
            column-gap: 10px
        }
        .message {
            margin-bottom: 10px;
            padding: 8px 12px;
            border-radius: 15px;
            max-width:40%;

        }
        .user {
            background-color: #007bff;
            color: #fff;
            align-self: flex-end;
            margin-left: auto; /* Push user messages to the right */
        }
        .bot {
            background-color: #f0f0f0;
            color: #333;
            align-self: flex-start;
        }
        /* CSS for typing indicator */
        .typing-indicator {
            display: none;
            margin-bottom: 5px; /* Move typing indicator to the bottom */
            font-style: italic;
            align-self: flex-end; /* Align to the right */
        }
        .typing-indicator::after {
            content: 'Typing...';
            animation: typing 1s infinite;
        }
        @keyframes typing {
            0% { opacity: 0; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        /* CSS for input field */
        .form-control {
            border-radius: 10px;
            width: 70%;
        }

        /* CSS for send button */
        .btn-primary {
            border-radius: 10px;
        }

    </style>

    <div class="container">
        <div class="row">
            <div class="col-6 offset-1">
                <div class="card">
                    <div class="card-header">
                        <h3 class="text-center">Chatbot Interface</h3>
                    </div>
                    <div class="card-body">
                        <div>
                            <div id="chat-container" class="overflow-auto"></div>
                            <!-- Typing indicator -->
                            <div class="typing-indicator" id="typing-indicator"></div>
                        </div>
                        
                        
                    </div>
                    <div class="card-footer">
                        <form id="chat-form" class="input-group">
                            <input type="text" id="message-input" class="form-control" placeholder="Type your message..." aria-label="Type your message..." aria-describedby="send-button">
                            <div class="input-group-append">
                                <button type="submit" class="btn btn-primary" id="send-button">Send</button>
                            </div>
                        </form>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const chatContainer = document.getElementById('chat-container');
            const typingIndicator = document.getElementById('typing-indicator');
            const messageInput = document.getElementById('message-input');

            function addMessage(message, isUser = false) {
                const messageElement = document.createElement('div');
                messageElement.classList.add('message', isUser ? 'user' : 'bot');
                messageElement.innerText = message;
                chatContainer.appendChild(messageElement);
                chatContainer.scrollTop = chatContainer.scrollHeight; // Scroll to bottom
            }

            function showTypingIndicator() {
                typingIndicator.style.display = 'block';
            }

            function hideTypingIndicator() {
                typingIndicator.style.display = 'none';
            }

            document.getElementById('chat-form').addEventListener('submit', function(event) {
                event.preventDefault();
                const message = messageInput.value.trim();
                if (message === '') return;
                
                addMessage(`You: ${message}`, true);
                showTypingIndicator();
                setTimeout(sendMessageToChatbot, 1000, message);
                messageInput.value = '';
            });

            function sendMessageToChatbot(message) {
                // Replace this with your actual API request logic
                const apiUrl = 'http://localhost:8000/aibot';
                fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ message }),
                })
                .then(response => response.json())
                .then(data => {
                    hideTypingIndicator();
                    const botMessage = data.message;
                    addMessage(`Bot: ${botMessage}`);
                })
                .catch(error => {
                    hideTypingIndicator();
                    addMessage('Bot: Sorry, an error occurred.');
                    console.error('Error:', error);
                });
            }
        });
    </script>
{% endblock %}
